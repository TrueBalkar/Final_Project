<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>auction.bidding API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>auction.bidding</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from auction.imports import get_money, select_by_id_price, update_price, update_money, select_by_id_name, \
    select_by_id, select_items, select_from_bidden_items, ConnectToDatabase, select_from_bidden_price, \
    update_bidden_items, update_bidden_price, update_last_bidder, delete_item_data
from flask import request, session, flash, redirect, url_for
import math
import datetime


def get_budget() -&gt; str:
    &#34;&#34;&#34;
    Function used to display beautiful numbers.

    :return: User current budget with beautiful comas after every thousand of thousands.
    &#34;&#34;&#34;
    budget = &#34;{:,}&#34;.format(get_money(session[&#39;username&#39;]))
    return budget


def bid_on_the_item(bid_price: float, link_to_return: str):
    &#34;&#34;&#34;
    Function that do all bidding related tasks.

    :param bid_price: Amount of money user wish to add to the price of the item.
    :param link_to_return: Link to refresh page
    :return: Update data of bidden item, user, refresh page and display messages.
    &#34;&#34;&#34;
    &#34;&#34;&#34;
    Getting item data from &lt;input ...&gt;&lt;/input&gt; html tag.
    &#34;&#34;&#34;
    bidden_item = request.form.get(&#39;bid_item&#39;)
    time_left = request.form.get(&#39;time_left&#39;)
    &#34;&#34;&#34;
    If item exist... The fun part begin!
    &#34;&#34;&#34;
    if bidden_item is not None:
        &#34;&#34;&#34;
        If user at least have enough money to increase the price without the actual price of the product.
        The process will not stop, otherwise it will be stopped and corresponding message displayed.
        &#34;&#34;&#34;
        if get_money(session[&#39;username&#39;]) &gt;= bid_price and time_left != &#34;Expired&#34;:
            &#34;&#34;&#34;
            Check if user have ever bidden on this item. And how much he has bidden.
            &#34;&#34;&#34;
            bidden_items = select_from_bidden_items(session[&#39;username&#39;])
            bidden_price = select_from_bidden_price(session[&#39;username&#39;])
            item = None
            iteration = 0
            for i in bidden_items:
                if i == bidden_item:
                    item = i
                    bidden_price[iteration] = float(bidden_price[iteration])
                    break
                iteration += 1
            &#34;&#34;&#34;
            If he didn&#39;t then id of the item and new price will be inserted into the user database as well as
            new price in item database, if user has enough money to finish transaction.
            &#34;&#34;&#34;
            if not item:
                if get_money(session[&#39;username&#39;]) &gt;= bid_price + select_by_id_price(bidden_item):
                    update_price(bidden_item, select_by_id_price(bidden_item) + bid_price)
                    bidden_items.append(str(bidden_item))
                    bidden_price[iteration] = select_by_id_price(bidden_item)
                    bidden_price.append(str(select_by_id_price(bidden_item)))
                    update_bidden_items(session[&#39;username&#39;], bidden_items)
                    update_bidden_price(session[&#39;username&#39;], bidden_price)
                    update_money(session[&#39;username&#39;], get_money(session[&#39;username&#39;])
                                 - (select_by_id_price(bidden_item)))
                else:
                    flash(f&#34;You don&#39;t have enough money for this bid!&#34;, category=&#34;danger&#34;)
                    &#34;&#34;&#34;
                    Refreshing page!
                    &#34;&#34;&#34;
                    return redirect(url_for(link_to_return))
            else:
                bid_price_2 = select_by_id_price(bidden_item) - bidden_price[iteration] + bid_price
                update_price(bidden_item, select_by_id_price(bidden_item) + bid_price)
                update_bidden_price(session[&#39;username&#39;], bidden_price)
                update_money(session[&#39;username&#39;], get_money(session[&#39;username&#39;]) - bid_price_2)
            &#34;&#34;&#34;
            The last bidder will be updated to user login if transaction ended successfully,
            which will make him future owner of the item if no one else bid on it.
            &#34;&#34;&#34;
            update_last_bidder(session[&#39;username&#39;], bidden_item)
            flash(f&#34;Congratulations! You bid on &#34;
                  f&#34;{select_by_id_name(bidden_item)} for &#34;
                  f&#34;{select_by_id_price(bidden_item)}$! &#34;
                  f&#34;If no one else bid on this item for {time_left} it will be yours! &#34;
                  f&#34;Good luck!&#34;, category=&#34;success&#34;)
        else:
            flash(f&#34;You don&#39;t have enough money for this bid!&#34;, category=&#34;danger&#34;)
    &#34;&#34;&#34;
    Refreshing page!
    &#34;&#34;&#34;
    return redirect(url_for(link_to_return))


def update_balance(login: str, money: float, symbol: str):
    &#34;&#34;&#34;
    Update budget of some user.

    :param login: Login of the user.
    :param money: Amount of money to transfer of deduct from account.
    :param symbol: &#34;+&#34; or &#34;-&#34;. &#34;+&#34; is for transfering money to account and &#34;-&#34; to deduct them from account.
    :return: Update amount of user money and refresh page.
    &#34;&#34;&#34;
    if symbol == &#34;+&#34;:
        if money &lt;= 0:
            money *= -1
        o_money = get_money(login) + money
        update_money(login, o_money)
        o_money = &#34;{:,}&#34;.format(math.trunc(o_money * 100) / 100)
        money = &#34;{:,}&#34;.format(math.trunc(money * 100) / 100)
        if session[&#39;username&#39;] == login:
            flash(f&#34;Congratulation! {money}$ was successfully transfered &#34;
                  f&#34;to your account! Now you have {o_money}$!&#34;, category=&#34;success&#34;)
        else:
            flash(f&#34;Congratulation! {money}$ was successfully transfered &#34;
                  f&#34;to {login}`s account! Now he has {o_money}$!&#34;, category=&#34;success&#34;)
        return redirect(url_for(&#34;my_office_page&#34;))
    if symbol == &#34;-&#34;:
        if money &lt;= 0:
            money *= -1
        o_money = get_money(login) - money
        if o_money &lt; 0:
            o_money = 0
        update_money(login, o_money)
        o_money = &#34;{:,}&#34;.format(math.trunc(o_money * 100) / 100)
        money = &#34;{:,}&#34;.format(math.trunc(money * 100) / 100)
        if session[&#39;username&#39;] == login:
            flash(f&#34;Congratulation! {money}$ was successfully deducted &#34;
                  f&#34;from your account! Now you have {o_money}$!&#34;, category=&#34;success&#34;)
        else:
            flash(f&#34;Congratulation! {money}$ was successfully deducted &#34;
                  f&#34;from {login}`s account! Now he has {o_money}$!&#34;, category=&#34;success&#34;)
        return redirect(url_for(&#34;my_office_page&#34;))


def return_money_to_losers(last_bidder: str, item_id: int) -&gt; None:
    &#34;&#34;&#34;
    Return money to those who lost bid on the item.

    :param last_bidder: Name of the winner
    :param item_id: id of the won item.
    :return: Transfer money to those who lost.
    &#34;&#34;&#34;
    ConnectToDatabase.cursor.execute(&#34;SELECT login FROM users&#34;)
    users = ConnectToDatabase.cursor.fetchall()[0]
    item_id = str(item_id)
    for i in users:
        if i != last_bidder:
            bidden_items = select_from_bidden_items(i)
            bidden_price = select_from_bidden_price(i)
            iteration = 0
            for n in bidden_items:
                if n == item_id:
                    update_balance(i, float(bidden_price[iteration]), &#34;+&#34;)
                    bidden_price.remove(bidden_price[iteration])
                    bidden_items.remove(n)
                    update_bidden_items(i, bidden_items)
                    update_bidden_price(i, bidden_price)


def put_on_auction(price: float, date: str, time: str):
    &#34;&#34;&#34;
    Function for putting owned item on auction.

    :param price: Starting price of the item.
    :param date: Date till end of auction for this item.
    :param time: Time till end of auction for this item.
    :return: Refresh page and post item.
    &#34;&#34;&#34;
    item_id = request.form.get(&#39;sell_item&#39;)
    ConnectToDatabase.cursor.execute(f&#39;UPDATE auction SET price = {price}, bid_time = &#34;{date} {time}&#34; &#39;
                                     f&#39;WHERE id = {item_id}&#39;)
    ConnectToDatabase.db_connection.commit()
    flash(&#34;Your item was successfully posted on the auction!&#34;, category=&#34;success&#34;)
    return redirect(url_for(&#34;my_bids_page&#34;))


def get_values_for_auction(*item_id: list) -&gt; list:
    &#34;&#34;&#34;
    This func get item values from database to display them in a nice way.

    :param item_id: id&#39;s of items if all items not needed
    :return: Dictionary of parameters of items
    &#34;&#34;&#34;
    items = []
    columns = []
    item = {}
    item.update({&#34;id&#34;: None, &#34;item&#34;: None, &#34;owners&#34;: None, &#34;descript&#34;: None, &#34;price&#34;: None,
                 &#34;time_left&#34;: None, &#34;last_bidder&#34;: None})
    data = []
    for i in item.keys():
        &#34;&#34;&#34;
        Filling columns of future list of dictionaries.
        &#34;&#34;&#34;
        columns.append(i)
    if item_id:
        &#34;&#34;&#34;
        If some id&#39;s were passed. Only those specific item&#39;s info will be used.
        &#34;&#34;&#34;
        for i in item_id:
            for n in i:
                if select_by_id(n):
                    data.append(select_by_id(n))
        data = [data]
    else:
        &#34;&#34;&#34;
        Else every single item&#39;s info shall be passed.
        &#34;&#34;&#34;
        data.append(select_items())
    for i in range(len(data[0])):
        &#34;&#34;&#34;
        Filling rows of the future list of dictionaries.
        &#34;&#34;&#34;
        for j in range(len(columns)):
            item.update({columns[j]: data[0][i][j]})
            if columns[j] == &#34;price&#34;:
                if data[0][i][j] &lt; round(data[0][i][j]):
                    buff = &#34;{:,}&#34;.format(math.trunc(data[0][i][j] * 100) / 100)
                else:
                    buff = &#34;{:,}&#34;.format(round(data[0][i][j], 2))
                item.update({columns[j]: buff})
            if columns[j] == &#34;time_left&#34;:
                if datetime.datetime.today() &lt; data[0][i][j]:
                    item.update({columns[j]: str(data[0][i][j] - datetime.datetime.today())[:8]})
                else:
                    item.update({columns[j]: &#34;Expired&#34;})
        items.append(dict(item))
    return items


def add_new_item(item: str, description: str, price: float, bid_date: str, bid_time: str):
    &#34;&#34;&#34;
    Add new item to auction.

    :param item: Name of the item.
    :param description: Description of the item.
    :param price: Price of the item.
    :param bid_date: Date till end of auction for this item.
    :param bid_time: Time till end of auction for this item.
    :return: Add new item to auction and refresh the page.
    &#34;&#34;&#34;
    price = math.trunc(price * 100) / 100
    ConnectToDatabase.cursor.execute(f&#39;SELECT MAX(id) FROM auction&#39;)
    max_id = ConnectToDatabase.cursor.fetchall()[0][0] + 1
    try:
        ConnectToDatabase.cursor.execute(f&#39;INSERT INTO auction (id, item, owners, descript, &#39;
                                         f&#39;price, last_bidder, bid_time) VALUES ({max_id}, &#39;
                                         f&#39;&#34;{item}&#34;, &#34;{session[&#34;username&#34;]}&#34;, &#34;{description}&#34;, &#39;
                                         f&#39;{price},&#34;&#34; , &#34;{bid_date} {bid_time}&#34;)&#39;)
    except:
        flash(&#39;Something went wrong! Make sure not to write &#34;&#34; symbols while adding new item!&#39;, category=&#34;danger&#34;)
        return redirect(url_for(&#34;my_office_page&#34;))
    ConnectToDatabase.db_connection.commit()
    flash(f&#39;Dear {session[&#34;username&#34;]}, your new item {item} was successfully posted on auction! &#39;
          f&#39;Wish you the best of luck in selling the item with highest price! Thanks for using our &#39;
          f&#39;services!&#39;, category=&#34;success&#34;)
    return redirect(url_for(&#34;my_office_page&#34;))


def delete_item(item_id: int) -&gt; None:
    &#34;&#34;&#34;
    Delete the item using item&#39;s id.

    :param item_id: id of the item which data you wish to erase.
    :return: Erase data if item exist.
    &#34;&#34;&#34;
    &#34;&#34;&#34;
    Check if item with this id exist and erase data if it does.
    &#34;&#34;&#34;
    if delete_item_data(item_id):
        &#34;&#34;&#34;
        Erase data of bid history on this item from users;
        &#34;&#34;&#34;
        ConnectToDatabase.cursor.execute(&#34;SELECT login FROM users&#34;)
        users = ConnectToDatabase.cursor.fetchall()
        item_id = str(item_id)
        for i in users:
            i = i[0]
            bidden_items = select_from_bidden_items(i)
            bidden_price = select_from_bidden_price(i)
            iteration = 0
            for n in bidden_items:
                if n == item_id:
                    update_balance(i, float(bidden_price[iteration]), &#34;+&#34;)
                    bidden_price.remove(bidden_price[iteration])
                    bidden_items.remove(n)
                    update_bidden_items(i, bidden_items)
                    update_bidden_price(i, bidden_price)
        flash(f&#39;Item with id {item_id} was successfully deleted!&#39;, category=&#34;success&#34;)
    else:
        flash(f&#39;It seems item with id {item_id} doesn`t exist!&#39;, category=&#34;danger&#34;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="auction.bidding.add_new_item"><code class="name flex">
<span>def <span class="ident">add_new_item</span></span>(<span>item: str, description: str, price: float, bid_date: str, bid_time: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Add new item to auction.</p>
<p>:param item: Name of the item.
:param description: Description of the item.
:param price: Price of the item.
:param bid_date: Date till end of auction for this item.
:param bid_time: Time till end of auction for this item.
:return: Add new item to auction and refresh the page.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_new_item(item: str, description: str, price: float, bid_date: str, bid_time: str):
    &#34;&#34;&#34;
    Add new item to auction.

    :param item: Name of the item.
    :param description: Description of the item.
    :param price: Price of the item.
    :param bid_date: Date till end of auction for this item.
    :param bid_time: Time till end of auction for this item.
    :return: Add new item to auction and refresh the page.
    &#34;&#34;&#34;
    price = math.trunc(price * 100) / 100
    ConnectToDatabase.cursor.execute(f&#39;SELECT MAX(id) FROM auction&#39;)
    max_id = ConnectToDatabase.cursor.fetchall()[0][0] + 1
    try:
        ConnectToDatabase.cursor.execute(f&#39;INSERT INTO auction (id, item, owners, descript, &#39;
                                         f&#39;price, last_bidder, bid_time) VALUES ({max_id}, &#39;
                                         f&#39;&#34;{item}&#34;, &#34;{session[&#34;username&#34;]}&#34;, &#34;{description}&#34;, &#39;
                                         f&#39;{price},&#34;&#34; , &#34;{bid_date} {bid_time}&#34;)&#39;)
    except:
        flash(&#39;Something went wrong! Make sure not to write &#34;&#34; symbols while adding new item!&#39;, category=&#34;danger&#34;)
        return redirect(url_for(&#34;my_office_page&#34;))
    ConnectToDatabase.db_connection.commit()
    flash(f&#39;Dear {session[&#34;username&#34;]}, your new item {item} was successfully posted on auction! &#39;
          f&#39;Wish you the best of luck in selling the item with highest price! Thanks for using our &#39;
          f&#39;services!&#39;, category=&#34;success&#34;)
    return redirect(url_for(&#34;my_office_page&#34;))</code></pre>
</details>
</dd>
<dt id="auction.bidding.bid_on_the_item"><code class="name flex">
<span>def <span class="ident">bid_on_the_item</span></span>(<span>bid_price: float, link_to_return: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Function that do all bidding related tasks.</p>
<p>:param bid_price: Amount of money user wish to add to the price of the item.
:param link_to_return: Link to refresh page
:return: Update data of bidden item, user, refresh page and display messages.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def bid_on_the_item(bid_price: float, link_to_return: str):
    &#34;&#34;&#34;
    Function that do all bidding related tasks.

    :param bid_price: Amount of money user wish to add to the price of the item.
    :param link_to_return: Link to refresh page
    :return: Update data of bidden item, user, refresh page and display messages.
    &#34;&#34;&#34;
    &#34;&#34;&#34;
    Getting item data from &lt;input ...&gt;&lt;/input&gt; html tag.
    &#34;&#34;&#34;
    bidden_item = request.form.get(&#39;bid_item&#39;)
    time_left = request.form.get(&#39;time_left&#39;)
    &#34;&#34;&#34;
    If item exist... The fun part begin!
    &#34;&#34;&#34;
    if bidden_item is not None:
        &#34;&#34;&#34;
        If user at least have enough money to increase the price without the actual price of the product.
        The process will not stop, otherwise it will be stopped and corresponding message displayed.
        &#34;&#34;&#34;
        if get_money(session[&#39;username&#39;]) &gt;= bid_price and time_left != &#34;Expired&#34;:
            &#34;&#34;&#34;
            Check if user have ever bidden on this item. And how much he has bidden.
            &#34;&#34;&#34;
            bidden_items = select_from_bidden_items(session[&#39;username&#39;])
            bidden_price = select_from_bidden_price(session[&#39;username&#39;])
            item = None
            iteration = 0
            for i in bidden_items:
                if i == bidden_item:
                    item = i
                    bidden_price[iteration] = float(bidden_price[iteration])
                    break
                iteration += 1
            &#34;&#34;&#34;
            If he didn&#39;t then id of the item and new price will be inserted into the user database as well as
            new price in item database, if user has enough money to finish transaction.
            &#34;&#34;&#34;
            if not item:
                if get_money(session[&#39;username&#39;]) &gt;= bid_price + select_by_id_price(bidden_item):
                    update_price(bidden_item, select_by_id_price(bidden_item) + bid_price)
                    bidden_items.append(str(bidden_item))
                    bidden_price[iteration] = select_by_id_price(bidden_item)
                    bidden_price.append(str(select_by_id_price(bidden_item)))
                    update_bidden_items(session[&#39;username&#39;], bidden_items)
                    update_bidden_price(session[&#39;username&#39;], bidden_price)
                    update_money(session[&#39;username&#39;], get_money(session[&#39;username&#39;])
                                 - (select_by_id_price(bidden_item)))
                else:
                    flash(f&#34;You don&#39;t have enough money for this bid!&#34;, category=&#34;danger&#34;)
                    &#34;&#34;&#34;
                    Refreshing page!
                    &#34;&#34;&#34;
                    return redirect(url_for(link_to_return))
            else:
                bid_price_2 = select_by_id_price(bidden_item) - bidden_price[iteration] + bid_price
                update_price(bidden_item, select_by_id_price(bidden_item) + bid_price)
                update_bidden_price(session[&#39;username&#39;], bidden_price)
                update_money(session[&#39;username&#39;], get_money(session[&#39;username&#39;]) - bid_price_2)
            &#34;&#34;&#34;
            The last bidder will be updated to user login if transaction ended successfully,
            which will make him future owner of the item if no one else bid on it.
            &#34;&#34;&#34;
            update_last_bidder(session[&#39;username&#39;], bidden_item)
            flash(f&#34;Congratulations! You bid on &#34;
                  f&#34;{select_by_id_name(bidden_item)} for &#34;
                  f&#34;{select_by_id_price(bidden_item)}$! &#34;
                  f&#34;If no one else bid on this item for {time_left} it will be yours! &#34;
                  f&#34;Good luck!&#34;, category=&#34;success&#34;)
        else:
            flash(f&#34;You don&#39;t have enough money for this bid!&#34;, category=&#34;danger&#34;)
    &#34;&#34;&#34;
    Refreshing page!
    &#34;&#34;&#34;
    return redirect(url_for(link_to_return))</code></pre>
</details>
</dd>
<dt id="auction.bidding.delete_item"><code class="name flex">
<span>def <span class="ident">delete_item</span></span>(<span>item_id: int) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Delete the item using item's id.</p>
<p>:param item_id: id of the item which data you wish to erase.
:return: Erase data if item exist.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_item(item_id: int) -&gt; None:
    &#34;&#34;&#34;
    Delete the item using item&#39;s id.

    :param item_id: id of the item which data you wish to erase.
    :return: Erase data if item exist.
    &#34;&#34;&#34;
    &#34;&#34;&#34;
    Check if item with this id exist and erase data if it does.
    &#34;&#34;&#34;
    if delete_item_data(item_id):
        &#34;&#34;&#34;
        Erase data of bid history on this item from users;
        &#34;&#34;&#34;
        ConnectToDatabase.cursor.execute(&#34;SELECT login FROM users&#34;)
        users = ConnectToDatabase.cursor.fetchall()
        item_id = str(item_id)
        for i in users:
            i = i[0]
            bidden_items = select_from_bidden_items(i)
            bidden_price = select_from_bidden_price(i)
            iteration = 0
            for n in bidden_items:
                if n == item_id:
                    update_balance(i, float(bidden_price[iteration]), &#34;+&#34;)
                    bidden_price.remove(bidden_price[iteration])
                    bidden_items.remove(n)
                    update_bidden_items(i, bidden_items)
                    update_bidden_price(i, bidden_price)
        flash(f&#39;Item with id {item_id} was successfully deleted!&#39;, category=&#34;success&#34;)
    else:
        flash(f&#39;It seems item with id {item_id} doesn`t exist!&#39;, category=&#34;danger&#34;)</code></pre>
</details>
</dd>
<dt id="auction.bidding.get_budget"><code class="name flex">
<span>def <span class="ident">get_budget</span></span>(<span>) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Function used to display beautiful numbers.</p>
<p>:return: User current budget with beautiful comas after every thousand of thousands.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_budget() -&gt; str:
    &#34;&#34;&#34;
    Function used to display beautiful numbers.

    :return: User current budget with beautiful comas after every thousand of thousands.
    &#34;&#34;&#34;
    budget = &#34;{:,}&#34;.format(get_money(session[&#39;username&#39;]))
    return budget</code></pre>
</details>
</dd>
<dt id="auction.bidding.get_values_for_auction"><code class="name flex">
<span>def <span class="ident">get_values_for_auction</span></span>(<span>*item_id: list) ‑> list</span>
</code></dt>
<dd>
<div class="desc"><p>This func get item values from database to display them in a nice way.</p>
<p>:param item_id: id's of items if all items not needed
:return: Dictionary of parameters of items</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_values_for_auction(*item_id: list) -&gt; list:
    &#34;&#34;&#34;
    This func get item values from database to display them in a nice way.

    :param item_id: id&#39;s of items if all items not needed
    :return: Dictionary of parameters of items
    &#34;&#34;&#34;
    items = []
    columns = []
    item = {}
    item.update({&#34;id&#34;: None, &#34;item&#34;: None, &#34;owners&#34;: None, &#34;descript&#34;: None, &#34;price&#34;: None,
                 &#34;time_left&#34;: None, &#34;last_bidder&#34;: None})
    data = []
    for i in item.keys():
        &#34;&#34;&#34;
        Filling columns of future list of dictionaries.
        &#34;&#34;&#34;
        columns.append(i)
    if item_id:
        &#34;&#34;&#34;
        If some id&#39;s were passed. Only those specific item&#39;s info will be used.
        &#34;&#34;&#34;
        for i in item_id:
            for n in i:
                if select_by_id(n):
                    data.append(select_by_id(n))
        data = [data]
    else:
        &#34;&#34;&#34;
        Else every single item&#39;s info shall be passed.
        &#34;&#34;&#34;
        data.append(select_items())
    for i in range(len(data[0])):
        &#34;&#34;&#34;
        Filling rows of the future list of dictionaries.
        &#34;&#34;&#34;
        for j in range(len(columns)):
            item.update({columns[j]: data[0][i][j]})
            if columns[j] == &#34;price&#34;:
                if data[0][i][j] &lt; round(data[0][i][j]):
                    buff = &#34;{:,}&#34;.format(math.trunc(data[0][i][j] * 100) / 100)
                else:
                    buff = &#34;{:,}&#34;.format(round(data[0][i][j], 2))
                item.update({columns[j]: buff})
            if columns[j] == &#34;time_left&#34;:
                if datetime.datetime.today() &lt; data[0][i][j]:
                    item.update({columns[j]: str(data[0][i][j] - datetime.datetime.today())[:8]})
                else:
                    item.update({columns[j]: &#34;Expired&#34;})
        items.append(dict(item))
    return items</code></pre>
</details>
</dd>
<dt id="auction.bidding.put_on_auction"><code class="name flex">
<span>def <span class="ident">put_on_auction</span></span>(<span>price: float, date: str, time: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Function for putting owned item on auction.</p>
<p>:param price: Starting price of the item.
:param date: Date till end of auction for this item.
:param time: Time till end of auction for this item.
:return: Refresh page and post item.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def put_on_auction(price: float, date: str, time: str):
    &#34;&#34;&#34;
    Function for putting owned item on auction.

    :param price: Starting price of the item.
    :param date: Date till end of auction for this item.
    :param time: Time till end of auction for this item.
    :return: Refresh page and post item.
    &#34;&#34;&#34;
    item_id = request.form.get(&#39;sell_item&#39;)
    ConnectToDatabase.cursor.execute(f&#39;UPDATE auction SET price = {price}, bid_time = &#34;{date} {time}&#34; &#39;
                                     f&#39;WHERE id = {item_id}&#39;)
    ConnectToDatabase.db_connection.commit()
    flash(&#34;Your item was successfully posted on the auction!&#34;, category=&#34;success&#34;)
    return redirect(url_for(&#34;my_bids_page&#34;))</code></pre>
</details>
</dd>
<dt id="auction.bidding.return_money_to_losers"><code class="name flex">
<span>def <span class="ident">return_money_to_losers</span></span>(<span>last_bidder: str, item_id: int) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Return money to those who lost bid on the item.</p>
<p>:param last_bidder: Name of the winner
:param item_id: id of the won item.
:return: Transfer money to those who lost.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def return_money_to_losers(last_bidder: str, item_id: int) -&gt; None:
    &#34;&#34;&#34;
    Return money to those who lost bid on the item.

    :param last_bidder: Name of the winner
    :param item_id: id of the won item.
    :return: Transfer money to those who lost.
    &#34;&#34;&#34;
    ConnectToDatabase.cursor.execute(&#34;SELECT login FROM users&#34;)
    users = ConnectToDatabase.cursor.fetchall()[0]
    item_id = str(item_id)
    for i in users:
        if i != last_bidder:
            bidden_items = select_from_bidden_items(i)
            bidden_price = select_from_bidden_price(i)
            iteration = 0
            for n in bidden_items:
                if n == item_id:
                    update_balance(i, float(bidden_price[iteration]), &#34;+&#34;)
                    bidden_price.remove(bidden_price[iteration])
                    bidden_items.remove(n)
                    update_bidden_items(i, bidden_items)
                    update_bidden_price(i, bidden_price)</code></pre>
</details>
</dd>
<dt id="auction.bidding.update_balance"><code class="name flex">
<span>def <span class="ident">update_balance</span></span>(<span>login: str, money: float, symbol: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Update budget of some user.</p>
<p>:param login: Login of the user.
:param money: Amount of money to transfer of deduct from account.
:param symbol: "+" or "-". "+" is for transfering money to account and "-" to deduct them from account.
:return: Update amount of user money and refresh page.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_balance(login: str, money: float, symbol: str):
    &#34;&#34;&#34;
    Update budget of some user.

    :param login: Login of the user.
    :param money: Amount of money to transfer of deduct from account.
    :param symbol: &#34;+&#34; or &#34;-&#34;. &#34;+&#34; is for transfering money to account and &#34;-&#34; to deduct them from account.
    :return: Update amount of user money and refresh page.
    &#34;&#34;&#34;
    if symbol == &#34;+&#34;:
        if money &lt;= 0:
            money *= -1
        o_money = get_money(login) + money
        update_money(login, o_money)
        o_money = &#34;{:,}&#34;.format(math.trunc(o_money * 100) / 100)
        money = &#34;{:,}&#34;.format(math.trunc(money * 100) / 100)
        if session[&#39;username&#39;] == login:
            flash(f&#34;Congratulation! {money}$ was successfully transfered &#34;
                  f&#34;to your account! Now you have {o_money}$!&#34;, category=&#34;success&#34;)
        else:
            flash(f&#34;Congratulation! {money}$ was successfully transfered &#34;
                  f&#34;to {login}`s account! Now he has {o_money}$!&#34;, category=&#34;success&#34;)
        return redirect(url_for(&#34;my_office_page&#34;))
    if symbol == &#34;-&#34;:
        if money &lt;= 0:
            money *= -1
        o_money = get_money(login) - money
        if o_money &lt; 0:
            o_money = 0
        update_money(login, o_money)
        o_money = &#34;{:,}&#34;.format(math.trunc(o_money * 100) / 100)
        money = &#34;{:,}&#34;.format(math.trunc(money * 100) / 100)
        if session[&#39;username&#39;] == login:
            flash(f&#34;Congratulation! {money}$ was successfully deducted &#34;
                  f&#34;from your account! Now you have {o_money}$!&#34;, category=&#34;success&#34;)
        else:
            flash(f&#34;Congratulation! {money}$ was successfully deducted &#34;
                  f&#34;from {login}`s account! Now he has {o_money}$!&#34;, category=&#34;success&#34;)
        return redirect(url_for(&#34;my_office_page&#34;))</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="auction" href="index.html">auction</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="auction.bidding.add_new_item" href="#auction.bidding.add_new_item">add_new_item</a></code></li>
<li><code><a title="auction.bidding.bid_on_the_item" href="#auction.bidding.bid_on_the_item">bid_on_the_item</a></code></li>
<li><code><a title="auction.bidding.delete_item" href="#auction.bidding.delete_item">delete_item</a></code></li>
<li><code><a title="auction.bidding.get_budget" href="#auction.bidding.get_budget">get_budget</a></code></li>
<li><code><a title="auction.bidding.get_values_for_auction" href="#auction.bidding.get_values_for_auction">get_values_for_auction</a></code></li>
<li><code><a title="auction.bidding.put_on_auction" href="#auction.bidding.put_on_auction">put_on_auction</a></code></li>
<li><code><a title="auction.bidding.return_money_to_losers" href="#auction.bidding.return_money_to_losers">return_money_to_losers</a></code></li>
<li><code><a title="auction.bidding.update_balance" href="#auction.bidding.update_balance">update_balance</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>